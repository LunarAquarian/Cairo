<!--Polymer dependencies -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-auth-script.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-database-script.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-messaging-script.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-storage-script.html">
<!-- <link rel="import" href="../../core/cairo-app-shell.html">
<link rel="import" href="../../web-components/pwa-15-article/pwa-15-article.html">
<link rel="import" href="../../pages/view-page/view-page.html"> -->


<dom-module id="pwa-15-comment">
  <template>
    <style is="custom-style">
       :host {
        display: block;
      }

      .commentTitle {
        display: flex;
        flex-direction: row;
      }

      #commentPix {
        border-radius: 50%;
      }

      #commentUser {
        flex-grow: 2;
        color: burlywood;
      }

      #commentTime {
        text-align: right;
      }

      #talk,
      #commentUser {
        font-family: Arial, Helvetica, sans-serif;
        font-size: 20px;
      }

      #votes {
       font-family: Arial, Helvetica, sans-serif;
       font-size: 12px; 
      }
</style>


     <firebase-auth id="auth" user="{{user}}"> 

     <firebase-query id="query" path="/articles/[[artid]]/comments" data="{{commentk}}"></firebase-query> 
    
     <!-- <firebase-document
      path="/articles/[[articleId]]/comments/[[commentkey]]"
      data="{{commentkey}}"
    ></firebase-document>  -->
    
      

    <template is="dom-if" if="[[commentkey]]">
      <div class="commentTitle"><input type="text" value="[[artid]]"><span id="commentUser">[[username]]</span> <span id="commentTime"> [[timestamp]]</span></div>
      <p id="talk">[[comment]]</p> <input value="[[commentkey]]" id="pushId">
      <p>
        <paper-button raised on-tap="upvote">Upvote</paper-button><span id="votes">[[upvotes]]</span>
        <paper-button raised on-tap="downvote">Downvote</paper-button><span id="votes">[[downvotes]]</span>
      </p>
    </template>

  </template>

  <script>
    
    Polymer({
      is: 'pwa-15-comment',

      upvote: function () {
        var x = this.$$('#pushId').value;
        console.log(x);
        var votePath = this.$.query.ref.child(x);
        console.log(votePath);
        this.$.query.ref.child(x).once("value")
          .then(function (snapshot) {
            var upvotes = snapshot.child("Upvotes").val();
            console.log(upvotes);
            console.log("upvoted ", x);
            votePath.update({
              Upvotes: upvotes + 1
            })
          });
      },
      downvote: function () {
        var y = this.$$('#pushId').value;
        var downPath = this.$.query.ref.child(y);
        this.$.query.ref.child(y).once("value")
          .then(function (snapshot) {
            var downvotes = snapshot.child("Downvotes").val();
            console.log(downvotes);
            console.log("downvoted ", y);
            downPath.update({
              Downvotes: downvotes + 1
            })
          });
      }
    });
  </script>
</dom-module>